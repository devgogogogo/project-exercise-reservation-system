<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>공지 상세</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <style>
        .preserve{white-space:pre-wrap}
    </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
<header class="sticky top-0 z-20 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="max-w-4xl mx-auto px-6 py-3 flex items-center justify-between">
        <a th:href="@{/notices}" class="text-sm px-3 py-1.5 rounded-xl border bg-white hover:bg-slate-100">← 목록</a>
        <span class="text-sm text-slate-500">공지 상세</span>
    </div>
</header>

<main class="max-w-4xl mx-auto px-4 sm:px-6 py-8">
    <section class="bg-white border border-slate-200 rounded-2xl shadow-sm">
        <!-- 상단 제목/메타 -->
        <div class="px-6 pt-6 pb-4 border-b border-slate-100">
            <h1 id="title" class="text-2xl font-extrabold tracking-tight mb-2">로딩 중…</h1>
            <div class="flex items-center text-sm text-slate-500">
                <span id="writer">작성자: -</span>
                <time id="when" datetime="" class="ml-auto tabular-nums"></time>
            </div>
        </div>

        <!-- 본문 -->
        <article id="description" class="px-6 py-6 preserve text-slate-800 leading-7">
            잠시만요…
        </article>

        <!-- 하단 액션 -->
        <div class="px-6 pb-6">
            <a th:href="@{/notices}" class="px-4 py-2 rounded-xl border bg-white hover:bg-slate-50">목록</a>
        </div>
    </section>

    <!-- 에러 -->
    <p id="error" class="hidden mt-4 text-sm text-red-600"></p>
</main>

<script>
    // -------- 유틸: 다양한 형태(문자열/배열/객체) 날짜를 "yyyy-MM-dd HH:mm"으로 표기
    const pad = n => String(n).padStart(2,'0');
    function fmtDateTime(v){
        if(!v) return '';
        // 1) 문자열: "2025-10-27 13:45" or ISO "2025-10-27T13:45:00"
        if(typeof v === 'string'){
            // 공백/초단위 제거 정도만 보정
            const s = v.replace('T',' ').slice(0,16);
            // yyyy-MM-dd HH:mm 형태면 그대로
            if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/.test(s)) return s;
            const d = new Date(v);
            if(!isNaN(d.getTime()))
                return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
            return s;
        }
        // 2) 배열: [yyyy,MM,dd,HH,mm,ss]
        if(Array.isArray(v)){
            const [y, M, d, H=0, m=0] = v;
            if(y && M && d) return `${y}-${pad(M)}-${pad(d)} ${pad(H)}:${pad(m)}`;
            return '';
        }
        // 3) 객체: {year, monthValue, dayOfMonth, hour, minute ...}
        if(typeof v === 'object'){
            const y = v.year ?? v.y;
            const M = v.monthValue ?? v.month;
            const d = v.dayOfMonth ?? v.day;
            const H = v.hour ?? 0;
            const m = v.minute ?? 0;
            if(y && M && d) return `${y}-${pad(M)}-${pad(d)} ${pad(H)}:${pad(m)}`;
        }
        return '';
    }

    function $(id){ return document.getElementById(id); }
    const noticeId = location.pathname.split('/').filter(Boolean).pop();

    async function load(){
        try{
            const res = await fetch(`/api/notices/${noticeId}`, {credentials:'include'});
            if(!res.ok){
                if(res.status===404) throw new Error('해당 공지를 찾을 수 없습니다. (404)');
                throw new Error('불러오기 실패 (HTTP '+res.status+')');
            }
            // 기대 스키마: { noticeId, nickname, title, description, modifiedAt }
            const data = await res.json();

            $('title').textContent = data.title || '(제목 없음)';
            $('writer').textContent = `작성자: ${data.nickname ?? '-'}`;

            const when = fmtDateTime(data.modifiedAt ?? data.updatedAt ?? data.createdAt);
            if (when) {
                $('when').textContent = when;
                $('when').setAttribute('datetime', when);
            } else {
                $('when').textContent = '';
            }

            $('description').textContent = data.description ?? '';
        }catch(e){
            $('error').textContent = e.message || '오류가 발생했습니다.';
            $('error').classList.remove('hidden');
        }
    }
    load();
</script>
</body>
</html>
