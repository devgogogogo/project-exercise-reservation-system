<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>CrossFit Box — 홈</title>

    <!-- Tailwind (개발용 CDN) -->
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script>
        tailwind.config = {theme: {extend: {}}}
    </script>

    <style>
        :root {
            --bg: #f6f7fb;
            --card: #ffffff;
            --text: #0f172a;
            --muted: #64748b;
            --primary: #0ea5e9;
            --primary-dark: #0284c7;
            --danger: #ef4444;
            --ring: #3ea1d5;
            --border: #e2e8f0;
        }

        body {
            background: linear-gradient(135deg, #f8fafc, var(--bg));
            color: var(--text);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-900 bg-gradient-to-b from-sky-50 to-indigo-50">

<!-- HEADER -->
<header class="border-b border-slate-200 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-14 flex items-center justify-between">
        <!-- 좌측: 로고 + 환영 문구 -->
        <div class="flex items-center gap-4">
            <a th:href="@{/}" class="font-extrabold tracking-tight text-xl">CrossFit Box</a>
            <!-- ▼ 로그인 시 표시 -->
            <div id="welcome-box" class="text-sm font-semibold text-slate-700 hidden">
                <span id="welcome-text"></span>
            </div>
        </div>

        <!-- 우측: 로그인/회원가입 or 로그아웃 -->
        <nav class="flex items-center gap-4">
            <a id="login-link" th:href="@{/login}" class="text-sm font-medium hover:text-sky-700">로그인</a>
            <a id="signup-link" th:href="@{/signup}" class="text-sm font-medium hover:underline">회원가입</a>
            <button id="logout-btn"
                    class="hidden text-sm font-medium px-3 py-1.5 rounded-lg border border-slate-300 hover:bg-slate-100">
                로그아웃
            </button>
        </nav>
    </div>

    <nav class="border-t border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between py-3">
                <ul class="flex gap-6 overflow-x-auto no-scrollbar text-sm font-semibold">
                    <li><a th:href="@{/notices}" class="hover:text-sky-700">크로스핏 이란?</a></li>
                    <li><a th:href="@{/booking}" class="hover:text-sky-700">코치 소개</a></li>
                    <li><a th:href="@{/program}" class="hover:text-sky-700">문의 사항</a></li>
                    <li><a th:href="@{/my}" class="hover:text-sky-700">오시는 길</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<!-- BODY -->
<main class="flex-1">
    <!-- 히어로 -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="bg-gradient-to-r from-indigo-500 via-sky-500 to-cyan-500 p-[1px] rounded-2xl shadow-lg">
            <div class="rounded-[14px] overflow-hidden">
                <img
                        src="https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2000&auto=format&fit=crop"
                        alt="크로스핏 히어로"
                        class="w-full h-[500px] md:h-[600px] object-cover"
                />
            </div>
        </div>
    </section>
    <!-- 네모 메뉴 (5칸 버전) -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4"> <!-- ✅ 변경: md:grid-cols-5 -->

            <!-- 공지사항 -->
            <a th:href="@{/notices}"
               class="block rounded-2xl border shadow-sm hover:shadow-md transition hover:ring-2 hover:ring-sky-200">
                <div class="flex flex-col items-center justify-center p-6 min-h-[120px]">
                    <div class="w-12 h-12 rounded-xl border flex items-center justify-center mb-3">📢</div>
                    <span class="font-bold">공지사항</span>
                </div>
            </a>

            <!-- 예약하기 -->
            <a th:href="@{/classSchedule-create}"
               class="block rounded-2xl border shadow-sm hover:shadow-md transition hover:ring-2 hover:ring-emerald-200">
                <div class="flex flex-col items-center justify-center p-6 min-h-[120px]">
                    <div class="w-12 h-12 rounded-xl border flex items-center justify-center mb-3">✅</div>
                    <span class="font-bold">예약 생성(관리자전용)</span>
                </div>
            </a>

            <!-- 실시간 예약 -->
            <a th:href="@{/classSchedule-list}"
               class="block rounded-2xl border shadow-sm hover:shadow-md transition hover:ring-2 hover:ring-sky-200">
                <div class="flex flex-col items-center justify-center p-6 min-h-[120px]">
                    <div class="w-12 h-12 rounded-xl border flex items-center justify-center mb-3">🗓️</div>
                    <span class="font-bold">실시간 예약목록</span>
                </div>
            </a>

            <!-- 프로그램 -->
            <a th:href="@{/program}"
               class="block rounded-2xl border shadow-sm hover:shadow-md transition hover:ring-2 hover:ring-sky-200">
                <div class="flex flex-col items-center justify-center p-6 min-h-[120px]">
                    <div class="w-12 h-12 rounded-xl border flex items-center justify-center mb-3">🏋️</div>
                    <span class="font-bold">프로그램</span>
                </div>
            </a>
            <!-- 내 정보 -->
            <a th:href="@{/my}"
               class="block rounded-2xl border shadow-sm hover:shadow-md transition hover:ring-2 hover:ring-sky-200">
                <div class="flex flex-col items-center justify-center p-6 min-h-[120px]">
                    <div class="w-12 h-12 rounded-xl border flex items-center justify-center mb-3">👤</div>
                    <span class="font-bold">내 정보</span>
                </div>
            </a>


        </div>
    </section>

</main>

<!-- FOOTER -->
<footer class="mt-auto border-t border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-sm text-gray-500">
        © <span th:text="${#dates.format(#dates.createNow(), 'yyyy')}"></span> CrossFit Box. All rights reserved.
    </div>
</footer>

<!-- ▼ 로그인 상태 환영 문구/버튼 토글 -->
<script>
    const welcomeBox = document.getElementById('welcome-box');
    const welcomeText = document.getElementById('welcome-text');
    const loginLink = document.getElementById('login-link');
    const signupLink = document.getElementById('signup-link');
    const logoutBtn = document.getElementById('logout-btn');

    function getAccessToken() {
        return localStorage.getItem('accessToken') || sessionStorage.getItem('accessToken');
    }

    function setAccessToken(token, remember = true) {
        (remember ? localStorage : sessionStorage).setItem('accessToken', token);
    }

    function clearAccessToken() {
        localStorage.removeItem('accessToken');
        sessionStorage.removeItem('accessToken');
    }

    async function fetchMe(accessToken) {
        if (!accessToken) throw new Error('NO_ACCESS');
        const res = await fetch('/api/users/me', {
            headers: {Authorization: `Bearer ${accessToken}`},
            credentials: 'include'
        });
        if (res.status === 401) throw new Error('EXPIRED');
        if (!res.ok) throw new Error('ME_FAIL');
        return res.json();
    }

    async function tryRefresh() {
        const res = await fetch('/api/users/refresh', {method: 'POST', credentials: 'include'});
        if (!res.ok) throw new Error('REFRESH_FAIL');
        const body = await res.json(); // { accessToken: "..." }
        setAccessToken(body.accessToken, true);
        return body.accessToken;
    }

    function showLoggedInUI(name) {
        welcomeText.textContent = `${name ?? '회원'}님 안녕하세요`;
        welcomeBox.classList.remove('hidden');
        loginLink.classList.add('hidden');
        signupLink.classList.add('hidden');
        logoutBtn.classList.remove('hidden');
    }

    function showLoggedOutUI() {
        welcomeBox.classList.add('hidden');
        loginLink.classList.remove('hidden');
        signupLink.classList.remove('hidden');
        logoutBtn.classList.add('hidden');
    }

    logoutBtn.addEventListener('click', async () => {
        try {
            // 필요 시 서버 로그아웃 API 호출
            // await fetch('/api/users/logout', { method: 'POST', credentials: 'include' });
        } finally {
            clearAccessToken();
            showLoggedOutUI();
            location.href = '/';
        }
    });

    (async function runWelcome() {
        let accessToken = getAccessToken();
        try {
            const me = await fetchMe(accessToken);
            showLoggedInUI(me.name ?? me.username);
        } catch (e) {
            if (e.message === 'EXPIRED') {
                try {
                    accessToken = await tryRefresh();
                    const me = await fetchMe(accessToken);
                    showLoggedInUI(me.name ?? me.username);
                } catch {
                    showLoggedOutUI();
                }
            } else {
                showLoggedOutUI();
            }
        }
    })();
</script>


</body>
</html>
