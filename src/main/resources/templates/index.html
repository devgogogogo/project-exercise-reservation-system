<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>CrossFit Box â€” í™ˆ</title>

    <!-- Tailwind (ê°œë°œìš© CDN) -->
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script>
        // í•„ìš”í•˜ë©´ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ê°€ëŠ¥
        tailwind.config = {
            theme: { extend: {} }
        }
    </script>

    <!-- ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ ìœ í‹¸ -->
    <style>
        :root{
            --bg:#f6f7fb; --card:#ffffff; --text:#0f172a; --muted:#64748b;
            --primary:#0ea5e9; --primary-dark:#0284c7; --danger:#ef4444; --ring:#3ea1d5;
            --border:#e2e8f0;
        }
        body{
            background: linear-gradient(135deg, #f8fafc, var(--bg));
            color: var(--text);
        }
        .no-scrollbar::-webkit-scrollbar{display:none;}
        .no-scrollbar{-ms-overflow-style:none; scrollbar-width:none;}
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-900
             bg-gradient-to-b from-sky-50 to-indigo-50">

<!-- HEADER -->
<header class="border-b border-slate-200 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-14 flex items-center justify-between">
        <!-- í™ˆ ë§í¬ëŠ” ë£¨íŠ¸ë¡œ -->
        <a th:href="@{/}" class="font-extrabold tracking-tight text-xl">CrossFit Box</a>
        <nav class="flex items-center gap-4">
            <a th:href="@{/login}" class="text-sm font-medium hover:text-sky-700">ë¡œê·¸ì¸</a>
            <a th:href="@{/signup}" class="text-sm font-medium hover:underline">íšŒì›ê°€ì…</a>
        </nav>
    </div>

    <nav class="border-t border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- â–¼ ìˆ˜ì •: ì¢Œì¸¡ ë©”ë‰´ + ìš°ì¸¡ í™˜ì˜ ë¬¸êµ¬ë¥¼ ê°™ì€ í–‰ì— ë°°ì¹˜ -->
            <div class="flex items-center justify-between py-3">
                <ul class="flex gap-6 overflow-x-auto no-scrollbar text-sm font-semibold">
                    <li><a th:href="@{/notices}"  class="hover:text-sky-700">í¬ë¡œìŠ¤í• ì´ë€?</a></li>
                    <li><a th:href="@{/booking}"  class="hover:text-sky-700">ì½”ì¹˜ ì†Œê°œ</a></li>
                    <li><a th:href="@{/program}"  class="hover:text-sky-700">ë¬¸ì˜ ì‚¬í•­</a></li>
                    <li><a th:href="@{/my}"       class="hover:text-sky-700">ì˜¤ì‹œëŠ” ê¸¸</a></li>
                </ul>
                <!-- ìš°ì¸¡ í™˜ì˜ ë¬¸êµ¬ ìë¦¬ -->
                <div id="welcome-box" class="text-sm font-semibold text-slate-700 hidden">
                    <span id="welcome-text"></span>
                </div>
            </div>
        </div>
    </nav>
</header>

<!-- BODY -->
<main class="flex-1">
    <!-- ê°€ìš´ë° íˆì–´ë¡œ ì´ë¯¸ì§€ -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="bg-gradient-to-r from-indigo-500 via-sky-500 to-cyan-500 p-[1px] rounded-2xl shadow-lg">
            <div class="rounded-[14px] overflow-hidden">
                <img
                        src="https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2000&auto=format&fit=crop"
                        alt="í¬ë¡œìŠ¤í• íˆì–´ë¡œ"
                        class="w-full h-[500px] md:h-[600px] object-cover"
                />
            </div>
        </div>
    </section>

    <!-- ê³µì§€ì‚¬í•­ & ì˜¤ëŠ˜ì˜ ìš´ë™ ì¹´ë“œ(ê°™ì€ í‹€) -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-6 grid gap-6 md:grid-cols-2">
        <!-- ê³µì§€ì‚¬í•­ -->
        <div class="bg-white rounded-2xl shadow p-6 border border-slate-100
              relative before:content-[''] before:absolute before:inset-x-0 before:top-0
              before:h-1 before:bg-gradient-to-r before:from-sky-400 before:to-indigo-400">
            <h3 class="text-lg font-extrabold mb-4">ê³µì§€ ì‚¬í•­</h3>
            <ul class="divide-y">
                <li class="py-3 flex items-center justify-between" th:each="n : ${notices}">
                    <a th:href="@{'/notices/' + ${n.id}}" class="truncate hover:underline" th:text="${n.title}">10ì›”
                        ê³µì§€ì‚¬í•­</a>
                    <span class="text-sm text-gray-400 shrink-0 ml-4"
                          th:text="${#temporals.format(n.date, 'yyyy.MM.dd')}">2025.09.29</span>
                </li>
                <li class="py-3 flex items-center justify-between" th:if="${#lists.isEmpty(notices)}">
                    <span class="text-gray-500">ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
                </li>
            </ul>
            <div class="mt-4 text-right">
                <a th:href="@{/notices}" class="text-sm font-semibold text-sky-700 hover:underline">ì „ì²´ ë³´ê¸°</a>
            </div>
        </div>

        <!-- ì˜¤ëŠ˜ì˜ ìš´ë™ -->
        <div class="bg-white rounded-2xl shadow p-6 border border-slate-100
              relative before:content-[''] before:absolute before:inset-x-0 before:top-0
              before:h-1 before:bg-gradient-to-r before:from-sky-400 before:to-indigo-400">
            <h3 class="text-lg font-extrabold mb-4">ì˜¤ëŠ˜ì˜ ìš´ë™ (WOD)</h3>
            <ul class="divide-y">
                <li class="py-3 flex items-center justify-between" th:each="w : ${wods}">
                    <a th:href="@{'/wod/' + ${w.id}}" class="truncate hover:underline" th:text="${w.title}">
                        Strength: Back Squat 5Ã—5 / Metcon: 12â€™ AMRAP
                    </a>
                    <span class="text-sm text-gray-400 shrink-0 ml-4"
                          th:text="${#temporals.format(w.date, 'yyyy.MM.dd')}">2025.09.29</span>
                </li>
                <li class="py-3 flex items-center justify-between" th:if="${#lists.isEmpty(wods)}">
                    <span class="text-gray-500">ë“±ë¡ëœ WODê°€ ì—†ìŠµë‹ˆë‹¤.</span>
                </li>
            </ul>
            <div class="mt-4 text-right">
                <a th:href="@{/wod}" class="text-sm font-semibold text-sky-700 hover:underline">ì „ì²´ ë³´ê¸°</a>
            </div>
        </div>
    </section>

    <!-- ë„¤ëª¨ ë©”ë‰´ 4ê°œ -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <a th:href="@{/notices}" class="block rounded-2xl border shadow-sm hover:shadow-md transition
                                 hover:ring-2 hover:ring-sky-200">
                <div class="flex flex-col items-center justify-center p-6 min-h-[120px]">
                    <div class="w-12 h-12 rounded-xl border flex items-center justify-center mb-3">ğŸ“¢</div>
                    <span class="font-bold">ê³µì§€ì‚¬í•­</span>
                </div>
            </a>
            <a th:href="@{/reservation}"  class="block rounded-2xl border shadow-sm hover:shadow-md transition
                                 hover:ring-2 hover:ring-sky-200">
                <div class="flex flex-col items-center justify-center p-6 min-h-[120px]">
                    <div class="w-12 h-12 rounded-xl border flex items-center justify-center mb-3">ğŸ—“ï¸</div>
                    <span class="font-bold">ìˆ˜ì—… ì˜ˆì•½</span>
                </div>
            </a>
            <a th:href="@{/my}" class="block rounded-2xl border shadow-sm hover:shadow-md transition
                                 hover:ring-2 hover:ring-sky-200">
                <div class="flex flex-col items-center justify-center p-6 min-h-[120px]">
                    <div class="w-12 h-12 rounded-xl border flex items-center justify-center mb-3">ğŸ‘¤</div>
                    <span class="font-bold">ë‚´ ì •ë³´</span>
                </div>
            </a>
            <a th:href="@{/program}" class="block rounded-2xl border shadow-sm hover:shadow-md transition
                                 hover:ring-2 hover:ring-sky-200">
                <div class="flex flex-col items-center justify-center p-6 min-h-[120px]">
                    <div class="w-12 h-12 rounded-xl border flex items-center justify-center mb-3">ğŸ‹ï¸</div>
                    <span class="font-bold">í”„ë¡œê·¸ë¨</span>
                </div>
            </a>
        </div>
    </section>
</main>

<!-- FOOTER -->
<footer class="mt-auto border-t border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-sm text-gray-500">
        Â© <span th:text="${#dates.format(#dates.createNow(), 'yyyy')}"></span> CrossFit Box. All rights reserved.
    </div>
</footer>

<!-- â–¼ ë¡œê·¸ì¸ ìƒíƒœ í™˜ì˜ ë¬¸êµ¬ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    (function () {
        const welcomeBox  = document.getElementById('welcome-box');
        const welcomeText = document.getElementById('welcome-text');

        // ì €ì¥ ìœ„ì¹˜/í‚¤ëŠ” í”„ë¡œì íŠ¸ì— ë§ê²Œ ì¡°ì •í•˜ì„¸ìš”.
        let accessToken = localStorage.getItem('accessToken');

        // ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ í•¨ìˆ˜
        async function fetchMe() {
            if (!accessToken) throw new Error('NO_ACCESS');
            const res = await fetch('/api/users/me', {
                headers: { Authorization: `Bearer ${accessToken}` },
                credentials: 'include' // refresh ì¿ í‚¤ ì „ëµì„ ì“¸ ë•Œ ì¬ë°œê¸‰ í˜¸ì¶œì— í•„ìš”
            });
            if (res.status === 401) throw new Error('EXPIRED');
            if (!res.ok) throw new Error('ME_FAIL');
            return res.json();
        }

        // access ë§Œë£Œ ì‹œ refreshë¡œ ì¬ë°œê¸‰
        async function tryRefresh() {
            const res = await fetch('/api/users/refresh', {
                method: 'POST',
                credentials: 'include' // refreshë¥¼ ì¿ í‚¤ë¡œ ê°–ê³  ìˆìœ¼ë©´ ìë™ ì „ì†¡
            });
            if (!res.ok) throw new Error('REFRESH_FAIL');
            const body = await res.json();
            // ì„œë²„ê°€ { accessToken: "..." } ìœ¼ë¡œ ë‚´ë ¤ì¤€ë‹¤ê³  ê°€ì •
            accessToken = body.accessToken;
            localStorage.setItem('accessToken', accessToken);
        }

        (async function run() {
            try {
                const me = await fetchMe();
                welcomeText.textContent = `${me.name}ë‹˜ ì–´ì„œì˜¤ì„¸ìš”`;
                welcomeBox.classList.remove('hidden');
            } catch (e) {
                if (e.message === 'EXPIRED') {
                    try {
                        await tryRefresh();
                        const me = await fetchMe();
                        welcomeText.textContent = `${me.name}ë‹˜ ì–´ì„œì˜¤ì„¸ìš”`;
                        welcomeBox.classList.remove('hidden');
                    } catch {
                        // ì¬ë°œê¸‰ ì‹¤íŒ¨í•˜ë©´ ë¡œê·¸ì¸ ë¬¸êµ¬ ìˆ¨ê¹€ ìœ ì§€
                        welcomeBox.classList.add('hidden');
                    }
                } else {
                    welcomeBox.classList.add('hidden');
                }
            }
        })();
    })();
</script>

</body>
</html>
